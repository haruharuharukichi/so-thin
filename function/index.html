<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="utf-8n">
	<meta name="Description" CONTENT="ここにページのディスクリプション">
	<meta name="description" content="">
	<meta name="keywords" content="">
	<meta name="author" content="Haruki Kawashita">
	<meta name="robots" content="noindex">
	<meta name="robots" content="nofollow">
	
	<meta property="og:title" content="ここにタイトル">
	<meta property="og:type" content="ここにタイプ">
	<meta property="og:url" content="ここにページのURL">
	<meta property="og:image" content="ここにサムネイル画像のURL">
	<meta property="og:site_name" content="ここにサイト名">
	<meta property="og:description" content="ここにページのディスクリプション">
	
	<meta property="fb:app_id" content="App-ID（15文字の半角数字）">
	
	<meta name="twitter:card" content="summary">
	<meta name="twitter:site" content="@Twitterアカウント">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<title>TITLE</title>
	<link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,600,900" rel="stylesheet">
	<script src="https://code.jquery.com/jquery-3.3.1.min.js"
		integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

	
	<script type="text/javascript" src="https://haruharuharukichi.github.io/so-thin/js/prettify.js"></script>
	<link href="https://haruharuharukichi.github.io/so-thin/css/prettify.css" type="text/css" rel="stylesheet">

	
	<link rel="stylesheet" href="https://haruharuharukichi.github.io/so-thin/css/iota.css" />

	<link rel="stylesheet" href="https://haruharuharukichi.github.io/so-thin/style.css">
</head>

<body onload="prettyPrint()">
	<nav role="navigation" id="globalNavi" class="grid inline-center navbar_wrapper sticky">
		<a href="https://haruharuharukichi.github.io/so-thin/" rel="home" class="flex navbar_brand">
			<span class="navbar_logo">
				LO<br>GO
			</span>
		</a>
		<button type="button" id="navbarToggler" class="navbar_toggler">
			<span></span>
			<span></span>
			<span></span>
		</button>
		<ul class="navbar_list font-sm">
			<li><a class="navbar_link" href="https://haruharuharukichi.github.io/so-thin/">home</a></li>
			<li><a class="navbar_link" href="https://haruharuharukichi.github.io/so-thin/naming">命名規則</a></li>
			<li><a class="navbar_link" href="https://haruharuharukichi.github.io/so-thin/flow">全体の流れ</a></li>
			<li><a class="navbar_link" href="https://haruharuharukichi.github.io/so-thin/function">function</a></li>
			<li><a class="navbar_link" href="https://haruharuharukichi.github.io/so-thin/plugin">plugin</a></li>
			<li><a class="navbar_link" href="https://haruharuharukichi.github.io/so-thin/material">素材</a></li>
			<li><a class="navbar_link" href="https://haruharuharukichi.github.io/so-thin/salary">給与</a></li>
			<li><a class="navbar_link" href="https://haruharuharukichi.github.io/so-thin/templates/">テンプレート</a></li>
			<li><a class="navbar_link" href="https://haruharuharukichi.github.io/so-thin/components/">コンポーネント</a></li>
		</ul>
	</nav>
	<div class="grid body_wrapper">
<aside role="complementary" class="sidebar_wrapper">
    <ul>
        
        <li>
            <a href="/so-thin/components/">
                COMPONENTS TOP
            </a>
        </li>
        
        <li>
            <a href="/so-thin/components/grid/">
                Grid
            </a>
        </li>
        
        <li>
            <a href="/so-thin/components/header/">
                Header
            </a>
        </li>
        
        <li>
            <a href="/so-thin/components/navigation/">
                Navigation
            </a>
        </li>
        
        <li>
            <a href="/so-thin/components/card/">
                Card
            </a>
        </li>
        
        <li>
            <a href="/so-thin/components/button/">
                Button
            </a>
        </li>
        
    </ul>
</aside>
<aside role="complementary" class="sidebar_wrapper">
    <div id="toc"></div>
</aside>
<main role="main">
    

<h1 id="function-php">function.php</h1>

<h2 id="phpベーシックコード">PHPベーシックコード</h2>

<p>function.phpの基礎的な記述内容です。<br />
先ず以下を張り付けてから、必要に応じてコードを追加していきましょう</p>

<pre><code class="language-php">&lt;?php

/*
*削除系・追加系・編集系の3種類
*系列を検索する際はCtrl+Fを押してから「○○系」と入力
*/

/******************削除系******************/

//SEO対策
// WordPressバージョン情報の削除
remove_action('wp_head', 'wp_generator');
// ショートリンクURLの削除
remove_action('wp_head', 'wp_shortlink_wp_head');
// wlwmanifestの削除
remove_action('wp_head', 'wlwmanifest_link');
// application/rsd+xmlの削除
remove_action('wp_head', 'rsd_link');
// RSSフィードのURLの削除
remove_action('wp_head', 'feed_links_extra', 3);


//自動成形停止
remove_filter( 'the_content', 'wpautop' );

function override_mce_options( $init_array ) {
    $init_array['indent']  = true;
    $init_array['wpautop'] = false;

    return $init_array;
}
add_filter( 'tiny_mce_before_init', 'override_mce_options' );


//ツールバー非表示
add_filter('show_admin_bar', '__return_false');


//Contact Form 7が読み込むCSSを削除
add_action( 'wp_enqueue_scripts', 'my_delete_plugin_styles' );
    function my_delete_plugin_styles() {
    wp_deregister_style( 'contact-form-7' );
}


//メディア挿入時のデフォルトのリンク先を「なし」に設定する
function webshufu_default_noimagelink() {
    $webshufu_default_imagelink = get_option( 'image_default_link_type' );
    if ($webshufu_default_imagelink !== 'none') {
    update_option('image_default_link_type', 'none');
    }
}
add_action('admin_init', 'webshufu_default_noimagelink', 10);


//imgタグのwidth,height削除
add_filter( 'post_thumbnail_html', 'remove_width_attribute', 10 );
add_filter( 'image_send_to_editor', 'remove_width_attribute', 10 );
function remove_width_attribute( $html ) {
    $html = preg_replace( '/(width|height)=&quot;\d*&quot;\s/', &quot;&quot;, $html );
    return $html;
}


/******************追加系******************/


//タイトル追加
function my_setup_theme() {
    add_theme_support( 'title-tag' );
}
add_action( 'after_setup_theme', 'my_setup_theme' );


//navigationの登録
register_nav_menu( 'Navigation', 'ナビゲーション' );


//ナビゲーションのアンカータグにクラスを追加
function add_menuclass($ulclass) {
return preg_replace('/&lt;a /', '&lt;a class=&quot;navbar_link&quot;', $ulclass);
}
add_filter('wp_nav_menu','add_menuclass');


// クラスを編集して、ナビゲーション表示中メニューに 'current' クラスを付与する
add_filter( 'nav_menu_css_class', 'remove_to_currentClass', 10, 2 );
function remove_to_currentClass( $classes, $item ) {
    $classes = array('');
    if( $item -&gt; current == true ) {
        $classes[] = 'current';
    }
    return $classes;
}

//カスタムヘッダー追加
add_theme_support( 'custom-header' );


//サムネイル追加
add_theme_support('post-thumbnails'); 


//カスタムロゴ追加
add_theme_support( 'custom-logo', array( 'size' =&gt; 'raindrops-logo' ) );


//フッターウィジェットエリア追加
register_sidebar(array(
    'name' =&gt; 'Footer' ,
    'id' =&gt; 'footer' ,
    'before_widget' =&gt; '&lt;div class=&quot;widget footer_widget&quot;&gt;',
    'after_widget' =&gt; '&lt;/div&gt;',
    'before_title' =&gt; '&lt;h3 class=&quot;footer_title&quot;&gt;',
    'after_title' =&gt; '&lt;/h3&gt;'
));


//wp_enqueue_script/styleを使ったファイル読み込み
if (!is_admin()) {
    function deregister_script(){  //　登録解除の項目
        wp_deregister_script('jquery');
    }
    function register_files(){  //　登録の項目
        wp_register_script('jquery', 'https://code.jquery.com/jquery-3.3.1.min.js', false, '3.3.1', false );
        wp_register_script( 'inview', get_theme_file_uri() .'/lib/js/jquery.inview.min.js', array( 'jquery' ), '', true);
        wp_register_style( 'googlefont','https://fonts.googleapis.com/css?family=Muli:400,800', array(), '', false);
        wp_register_style( 'iota',get_theme_file_uri() .'/lib/css/iota.css', array(), '', false);
        wp_register_script( 'main', get_theme_file_uri() .'/lib/js/main.js', array( 'jquery' ), '', true);
        wp_register_style( 'style', get_theme_file_uri() .'/style.css', array(), '', false);
    }
    function add_files() {  // 装備の項目
        //deregister_script();
        register_files();
        wp_enqueue_script('jquery');
        wp_enqueue_script('inview');
        wp_enqueue_style('googlefont');
        wp_enqueue_style('iota');
        wp_enqueue_script('main');
        wp_enqueue_style('style');
    }
    add_action('wp_enqueue_scripts', 'add_files');
}


// パンくずリスト表示
function breadcrumb(){
    global $post;
    $str ='';
    if(!is_home()&amp;&amp;!is_admin()){
        $str.= '&lt;div id=&quot;breadcrumb&quot; class=&quot;cf&quot;&gt;&lt;div itemscope class=&quot;breadcrumb_item&quot; itemtype=&quot;http://data-vocabulary.org/Breadcrumb&quot;&gt;';
        $str.= '&lt;a class=&quot;breadcrumb_link&quot; href=&quot;'. home_url() .'&quot; itemprop=&quot;url&quot;&gt;&lt;span itemprop=&quot;title&quot;&gt;HOME&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;';
        if(is_category()) {
            $cat = get_queried_object();
            if($cat -&gt; parent != 0){
                $ancestors = array_reverse(get_ancestors( $cat -&gt; cat_ID, 'category' ));
                foreach($ancestors as $ancestor){
                    $str.='&lt;div itemscope class=&quot;breadcrumb_item&quot; itemtype=&quot;http://data-vocabulary.org/Breadcrumb&quot;&gt;&lt;a class=&quot;breadcrumb_link&quot; href=&quot;'. get_category_link($ancestor) .'&quot; itemprop=&quot;url&quot;&gt;&lt;span itemprop=&quot;title&quot;&gt;'. get_cat_name($ancestor) .'&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;';
                }
            }
            $str.='&lt;div itemscope class=&quot;breadcrumb_item&quot; itemtype=&quot;http://data-vocabulary.org/Breadcrumb&quot;&gt;&lt;a class=&quot;breadcrumb_link&quot; href=&quot;'. get_category_link($cat -&gt; term_id). '&quot; itemprop=&quot;url&quot;&gt;&lt;span itemprop=&quot;title&quot;&gt;'. $cat-&gt; cat_name . '&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;';
        } elseif(is_page()){
            if($post -&gt; post_parent != 0 ){
                $ancestors = array_reverse(get_post_ancestors( $post-&gt;ID ));
                foreach($ancestors as $ancestor){
                    $str.='&lt;div itemscope class=&quot;breadcrumb_item&quot; itemtype=&quot;http://data-vocabulary.org/Breadcrumb&quot;&gt;&lt;a class=&quot;breadcrumb_link&quot; href=&quot;'. get_permalink($ancestor).'&quot; itemprop=&quot;url&quot;&gt;&lt;span itemprop=&quot;title&quot;&gt;'. get_the_title($ancestor) .'&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;';
                }
            }
        } elseif(is_single()){
            $categories = get_the_category($post-&gt;ID);
            $cat = $categories[0];
            if($cat -&gt; parent != 0){
                $ancestors = array_reverse(get_ancestors( $cat -&gt; cat_ID, 'category' ));
                foreach($ancestors as $ancestor){
                    $str.='&lt;div itemscope class=&quot;breadcrumb_item&quot; itemtype=&quot;http://data-vocabulary.org/Breadcrumb&quot;&gt;&lt;a class=&quot;breadcrumb_link&quot; href=&quot;'. get_category_link($ancestor).'&quot; itemprop=&quot;url&quot;&gt;&lt;span itemprop=&quot;title&quot;&gt;'. get_cat_name($ancestor). '&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;';
                }
            }
            $str.='&lt;div itemscope class=&quot;breadcrumb_item&quot; itemtype=&quot;http://data-vocabulary.org/Breadcrumb&quot;&gt;&lt;a class=&quot;breadcrumb_link&quot; href=&quot;'. get_category_link($cat -&gt; term_id). '&quot; itemprop=&quot;url&quot;&gt;&lt;span itemprop=&quot;title&quot;&gt;'. $cat-&gt; cat_name . '&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;';
        } else{
            $str.='&lt;div class=&quot;breadcrumb_item&quot;&gt;&lt;span itemprop=&quot;title&quot;&gt;'. wp_title('', false) .'&lt;/span&gt;&lt;/div&gt;';
        }
        $str.='&lt;/div&gt;';
    }
    echo $str;
}


//ページネーション追加
function wp_pagination($page,$total) {
    global $wp_query;
    $big = 99999999;
    $page_format = paginate_links( array(
        'base' =&gt; str_replace( $big, '%#%', esc_url( get_pagenum_link( $big ) ) ),
        'format' =&gt; '?paged=%#%',
        'current' =&gt; max( 1, $page ),
        'total' =&gt; $total,
        'prev_text'          =&gt; __('&amp;laquo'),
        'next_text'          =&gt; __('&amp;raquo'),
        'type'  =&gt; 'array',
        'before_page_number' =&gt; '',
        'after_page_number' =&gt; ''
    ) );
    if( is_array($page_format) ) {
        $paged = ( get_query_var('paged') == 0 ) ? 1 : get_query_var('paged');
        echo '&lt;nav role=&quot;navigation&quot; aria-label=&quot;Page navigation&quot;&gt;&lt;ul class=&quot;flex main_pagination&quot;&gt;';
        foreach ( $page_format as $page ) {
            echo '&lt;li class=&quot;flex pagination_item&quot;&gt;'.$page.'&lt;/li&gt;';
        }
            echo '&lt;/ul&gt;&lt;/nav&gt;';
    }
    wp_reset_query();
}


/******************編集系******************/


//サムネイル表示文字数の調整
function new_excerpt_length($length) {	
    return 50;	
}	
add_filter( 'excerpt_length', 'new_excerpt_length');


//ループの表示記事数を指定
function hwl_home_pagesize( $query ) {
    if ( is_admin() || ! $query-&gt;is_main_query() )
        return;

    if ( is_home() ) {
        // オリジナルのブログアーカイブは投稿を3つ表示
        $query-&gt;set( 'posts_per_page', 3 );
        return;
    }
    if ( is_archive()|| is_search() ) {
        // オリジナルのブログアーカイブは投稿を9つ表示
        $query-&gt;set( 'posts_per_page', 9 );
        return;
    }

}
add_action( 'pre_get_posts', 'hwl_home_pagesize', 1 );
</code></pre>

<h2 id="予約状況反映カレンダー">予約状況反映カレンダー</h2>

<p>予約カレンダーが必要な場合は以下のコードを張り付けましょう<br />
初期設定では</p>

<ul>
<li>固定ページでカスタムフィールドを利用</li>
<li>〇△▼×-により状況を表示</li>
<li>一日を2分割</li>
<li>3ヶ月分を表示</li>
</ul>

<p>となっています。<br />
必要に応じて編集しましょう。
カレンダーのスライドショー表示にslickを使用しています。<br />
表示させる際にはJS,CSSの読み込みを忘れずに。<br />
尚、このカレンダーは管理画面から予約状況を反映させる為だけのカレンダーなので、実用の際にはCF7等を使って予約フォームを作成しないといけません。
実装サイトは<a href="https://ao.to/reserve">https://ao.to/reserve</a> です</p>

<h3 id="ベースコード">ベースコード</h3>

<pre><code class="language-php">/*【ここから】カスタム投稿とカスタムフィールドを使って予約状況を反映するカレンダーを作成*/
/*
add_post_metaのmeta_valueを配列に
set_calendar_keysを操作
*/
function add_schedule(){
    $post_id = '';
      if(isset($_GET['post']) || isset($_POST['post_ID'])) {
        $post_id = $_GET['post'] ? $_GET['post'] : $_POST['post_ID'] ;
      }

      $page_reserve = get_page_by_path('y');
      $page_id = $page_reserve -&gt; ID;  //スラッグが「news」の固定ページの ID
     
      // ID を比較して、合致すればメタボックスを追加
      if ($post_id == $page_id){
        add_meta_box('schedule', '予約状況', 'insert_schedule', 'page', 'normal', 'high');
      }
}
add_action('admin_menu', 'add_schedule');
// カスタムフィールドでカレンダー表示
function insert_schedule(){
    global $post;
    wp_nonce_field(wp_create_nonce(__FILE__), 'my_nonce');
    echo '&lt;p&gt;予約状況を選択してください。【◯】予約可能　【△】やや空きあり　【▼】残りわずか　【×】予約不可　【休】休業日&lt;/p&gt;';
    //当月＋2ヵ月分の入力フォームを表示
    echo output_cf_calendar(date('Y'),date('n'));
    echo output_cf_calendar(date('Y'),date('n')+1);
    echo output_cf_calendar(date('Y'),date('n')+2);
}
// カレンダーをDBに保存
function save_schedule($post_id){
    $my_nonce = isset($_POST['my_nonce']) ? $_POST['my_nonce'] : null;
    if(!wp_verify_nonce($my_nonce, wp_create_nonce(__FILE__))) {
        return $post_id;
    }
    if(defined('DOING_AUTOSAVE') &amp;&amp; DOING_AUTOSAVE) { return $post_id; }
    if(!current_user_can('edit_post', $post_id)) { return $post_id; }
 
    //前月＋当月＋2ヵ月分のmeta_keyを設定
    $keys1 = set_calendar_keys(date('Y'),date('n')-1);
    $keys2 = set_calendar_keys(date('Y'),date('n'));
    $keys3 = set_calendar_keys(date('Y'),date('n')+1);
    $keys4 = set_calendar_keys(date('Y'),date('n')+2);
    $keys = array_merge($keys1,$keys2,$keys3,$keys4);
 
    foreach( $keys as $key ) {
        $prev_data1 = get_post_meta($post_id, $key1, true);
        $prev_data2 = get_post_meta($post_id, $key2, true);
        $prev_datas = array($prev_data1,$prev_data2);
        if (get_post_meta($post_id, $key)) {
                delete_post_meta($post_id, $key);
        }

        foreach ($prev_datas as $keyname =&gt; $value) {
            $keytime = $key.'_'.$keyname;
            $data = $_POST[$keytime];

            if( $value == &quot;&quot; ){
                add_post_meta($post_id, $keytime, $data, true);
            } elseif( $data != $value &amp;&amp; $data != &quot;&quot; ) {
                update_post_meta($post_id, $keytime, $data);
            } elseif( $data == &quot;&quot; ) {
                delete_post_meta($post_id, $keytime, $value);
            }
        }
        
    }
}
add_action('save_post', 'save_schedule');
//カスタムフィールド書き出し時のmeta_key設定
function set_calendar_keys($year,$month) {
    //前月、翌月、翌々月が年をまたぐ場合の処理
    if( $month &gt; 12 ) { $year = $year+1; $month = $month-12; }
    elseif( !$month ) { $year = $year-1; $month = 12; }
    //月末日の取得
    $l_day = date('t', strtotime($year.sprintf('%02d',$month).'01'));
    //一ヶ月分のmeta_key（dateYYYYMMDD）を配列$keysに格納
    for ( $i=1; $i&lt;=$l_day; $i++ ) {
        $keys[($i-1)] = 'date'.$year.sprintf('%02d',$month).sprintf('%02d',$i);
    }
    return $keys;
}
//カレンダーの祝日取得
function japan_holiday_ics($year) {
    // カレンダーID
    $calendar_id = urlencode('japanese__ja@holiday.calendar.google.com');
    $url = 'https://calendar.google.com/calendar/ical/'.$calendar_id.'/public/full.ics';
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
    $result = curl_exec($ch);
    curl_close($ch);
    if (!empty($result)) {
        $items = $sort = array();
        $start = false;
        $count = 0;
        foreach(explode(&quot;\n&quot;, $result) as $row =&gt; $line) {
            // 1行目が「BEGIN:VCALENDAR」でなければ終了
            if (0 === $row &amp;&amp; false === stristr($line, 'BEGIN:VCALENDAR')) {
                break;
            }
            // 改行などを削除
            $line = trim($line);
            // 「BEGIN:VEVENT」なら日付データの開始
            if (false !== stristr($line, 'BEGIN:VEVENT')) {
                $start = true;
            } elseif ($start) {
                // 「END:VEVENT」なら日付データの終了
                if (false !== stristr($line, 'END:VEVENT')) {
                    $start = false;
                    // 次のデータ用にカウントを追加
                    ++$count;
                } else {
                    // 配列がなければ作成
                    if (empty($items[$count])) {
                        $items[$count] = array('date' =&gt; null, 'title' =&gt; null);
                    }
                    // 「DTSTART;～」（対象日）の処理
                    if(0 === strpos($line, 'DTSTART;VALUE')) {
                        $date = explode(':', $line);
                        $date = end($date);
                        $items[$count]['date'] = $date;
                        // ソート用の配列にセット
                        $sort[$count] = $date;
                    }
                    // 「SUMMARY:～」（名称）の処理
                    elseif(0 === strpos($line, 'SUMMARY:')) {
                        list($title) = explode('/', substr($line, 8));
                        $items[$count]['title'] = trim($title);
                    }
                }
            }
        }
        // 日付でソート
        $items = array_combine($sort, $items);
        ksort($items);
        return $items;
    }
}
// 管理画面カレンダー生成
function output_cf_calendar($year,$month) {
    global $post;
 
    //翌月、翌々月が年をまたぐ場合
    if( $month &gt; 12 ) { $year = $year+1; $month = $month-12; }
    //月末日の取得
    $l_day = date('t', strtotime($year.sprintf('%02d',$month).'01'));
    //月初日の曜日の取得
    $first_week = date('w',strtotime($year.sprintf('%02d',$month).'01'));
    //セレクトメニューオプション
    $menu_options = array('◯','△','▼','×','休');
    //祝日を取得
    $holidays = japan_holiday_ics(date('Y'));
 
    $calendar = &lt;&lt;&lt;EOM
&lt;table class=&quot;calendar&quot;&gt;
    &lt;caption&gt;{$year}年{$month}月&lt;/caption&gt;
    &lt;tr&gt;
        &lt;th class=&quot;sun&quot;&gt;日&lt;/th&gt;
        &lt;th&gt;月&lt;/th&gt;
        &lt;th&gt;火&lt;/th&gt;
        &lt;th&gt;水&lt;/th&gt;
        &lt;th&gt;木&lt;/th&gt;
        &lt;th&gt;金&lt;/th&gt;
        &lt;th&gt;土&lt;/th&gt;
    &lt;/tr&gt;
EOM;
    for( $i=1; $i&lt;=$l_day+$first_week; $i++ ) {
        $day = $i-$first_week;
        if( $i%7 == 1 ) { $calendar .= '&lt;tr&gt;'.&quot;\n&quot;; }
        if( $day &lt;= 0 ) {
            $calendar .= '&lt;td&gt;&amp;nbsp;&lt;/td&gt;'.&quot;\n&quot;;
        } else {
            $key = 'date'.$year.sprintf('%02d',$month).sprintf('%02d',$day);
            $key1 = $key.'_0';
            $key2 = $key.'_1';
            $value1 = get_post_meta($post-&gt;ID, $key1, true);
            $value2 = get_post_meta($post-&gt;ID, $key2, true);
            $timestamp = mktime(0,0,0,$month,$day,$year);
            if( $timestamp == mktime(0,0,0,date('n'),date('j'),date('Y')) ) { $class=' class=&quot;today&quot;'; }
            elseif( date('w',$timestamp) == 0 || date('w',$timestamp) == 1 ) {
                $class=' class=&quot;sun&quot;';
            }
            elseif( !empty($holidays[date(&quot;Ymd&quot;, $timestamp)]) ) { $class=' class=&quot;holiday&quot;'; }
            else { $class = ''; }
            $calendar .= '&lt;td'.$class.'&gt;';
            $calendar .= $day.'&lt;br&gt;';
            $calendar .= '&lt;select name=&quot;'.$key1.'&quot;&gt;';

            if ( date('w',$timestamp) == 0 || date('w',$timestamp) == 1 ) {
                $calendar .= '&lt;option value=&quot;休&quot; selected&gt;休&lt;/option&gt;';
                $calendar .= '&lt;/select&gt;';
                $calendar .= '&lt;select name=&quot;'.$key2.'&quot;&gt;';
                $calendar .= '&lt;option value=&quot;休&quot; selected&gt;休&lt;/option&gt;';
            }else{
                foreach( $menu_options as $option ) {
                    if( $option == $value1 ) { $select = ' selected'; } else { $select = ''; }
                    $calendar .= '&lt;option value=&quot;'.$option.'&quot;'.$select.'&gt;'.$option.'&lt;/option&gt;';
                }
                $calendar .= '&lt;/select&gt;';
                $calendar .= '&lt;select name=&quot;'.$key2.'&quot;&gt;';
                foreach( $menu_options as $option ) {
                    if( $option == $value2 ) { $select = ' selected'; } else { $select = ''; }
                    $calendar .= '&lt;option value=&quot;'.$option.'&quot;'.$select.'&gt;'.$option.'&lt;/option&gt;';
                }
            }
            $calendar .= '&lt;/select&gt;';
            $calendar .= '&lt;/td&gt;'.&quot;\n&quot;;
        }
    }
    if( $i%7 &gt; 1 ) {
        for( $td=0; $td&lt;=7-($i%7); $td++) {
            $calendar .= '&lt;td&gt;&amp;nbsp;&lt;/td&gt;'.&quot;\n&quot;;
        }
    }
    $calendar .= '&lt;/tr&gt;'.&quot;\n&quot;;
    $calendar .= '&lt;/table&gt;'.&quot;\n&quot;;
    return $calendar;
}
// 管理画面のカレンダー表示編集
function reservation_output_css() {
    $post_id = '';
    if(isset($_GET['post']) || isset($_POST['post_ID'])) {
        $post_id = $_GET['post'] ? $_GET['post'] : $_POST['post_ID'] ;
    }

    $page_reserve = get_page_by_path('y');
    $page_id = $page_reserve -&gt; ID;  //スラッグが「news」の固定ページの ID

    // ID を比較して、合致すればメタボックスを追加
    if ($post_id == $page_id){
        $pt_reservation_css  = '&lt;style type=&quot;text/css&quot;&gt;';
        /*　カレンダー表示のカスタマイズ　*/
        $pt_reservation_css .= '#schedule .inside { text-align: center; }';
        $pt_reservation_css .= '#schedule table.calendar { border-collapse: collapse; border-spacing: 0; margin: 0 auto 20px; }';
        $pt_reservation_css .= '#schedule table.calendar caption { font-size: 150%; font-weight: bold; color: #999; padding: 5px 0; }';
        $pt_reservation_css .= '#schedule table.calendar tr th { border: solid 1px #ccc; padding: 3px; background: #666; color: #fff; }';
        $pt_reservation_css .= '#schedule table.calendar tr th.sun { background: #e66; }';
        $pt_reservation_css .= '#schedule table.calendar tr td { border: solid 1px #ccc; padding: 3px; text-align: left; }';
        $pt_reservation_css .= '#schedule table.calendar tr td.sun { background: #fee; }';
        $pt_reservation_css .= '#schedule table.calendar tr td.holiday { background: #fee; }';
        $pt_reservation_css .= '#schedule table.calendar tr td.today { background: #ffe; }';
        $pt_reservation_css .= '#schedule table.calendar tr td select { width: 4em; margin: 5px 10px; }';
        $pt_reservation_css .= '&lt;/style&gt;';
        echo $pt_reservation_css;
    }
}
add_action('admin_head', 'reservation_output_css');
// カレンダー固定ページ表示（1月分）
function output_single_calendar($year,$month) {
    global $post;
 
    //翌月、翌々月が年をまたぐ場合
    if( $month &gt; 12 ) { $year = $year+1; $month = $month-12; }
    //月末日の取得
    $l_day = date('t', strtotime($year.sprintf('%02d',$month).'01'));
    //月初日の曜日の取得
    $first_week = date('w',strtotime($year.sprintf('%02d',$month).'01'));
    //祝日を取得
    $holidays = japan_holiday_ics(date('Y'));
    
    $calendar = &lt;&lt;&lt;EOM
&lt;div class=&quot;calender_content&quot;&gt;&lt;table&gt;
    &lt;caption&gt;{$year}年{$month}月&lt;/caption&gt;
    &lt;tr&gt;
        &lt;th class=&quot;sun&quot;&gt;日&lt;/th&gt;
        &lt;th&gt;月&lt;/th&gt;
        &lt;th&gt;火&lt;/th&gt;
        &lt;th&gt;水&lt;/th&gt;
        &lt;th&gt;木&lt;/th&gt;
        &lt;th&gt;金&lt;/th&gt;
        &lt;th&gt;土&lt;/th&gt;
    &lt;/tr&gt;
EOM;
    /* calendar body start */
    for( $i=1; $i&lt;=$l_day+$first_week; $i++ ) {
        $day = $i-$first_week;
        if( $i%7 == 1 ) { $calendar .= '&lt;tr&gt;'.&quot;\n&quot;; }
        if( $day &lt;= 0 ) {
            $calendar .= '&lt;td&gt;&amp;nbsp;&lt;/td&gt;'.&quot;\n&quot;;
        } else {
            $key = 'date'.$year.sprintf('%02d',$month).sprintf('%02d',$day);
            $timestamp = mktime(0,0,0,$month,$day,$year);
            if( $timestamp == mktime(0,0,0,date('n'),date('j'),date('Y')) ) { $class=' class=&quot;today&quot;'; }
            elseif( date('w',$timestamp) == 0 || date('w',$timestamp) == 1 ) { $class=' class=&quot;sun&quot;'; }
            elseif( !empty($holidays[date(&quot;Ymd&quot;, $timestamp)]) ) { $class=' class=&quot;holiday&quot;'; }
            else { $class = ''; }
            $calendar .= '&lt;td'.$class.'&gt;';
                $calendar .= '&lt;span class=&quot;day&quot;&gt;'.$day.'&lt;/span&gt;';
            
            for ($j=0; $j &lt; 2 ; $j++) { 
                $keyname = $key.'_'.$j;
                $value = get_post_meta($post-&gt;ID, $keyname, true);
                if( $value == '休' ) { $value = '&lt;span class=&quot;off&quot;&gt;-&lt;/span&gt;'; }
                elseif( !$value ) { $value = '&lt;span class=&quot;undecided&quot;&gt;-&lt;/span&gt;'; }
                $calendar .= '&lt;div class=&quot;tzone&quot;&gt;'.$value.'&lt;/div&gt;';
            }
            $calendar .= '&lt;/td&gt;'.&quot;\n&quot;;
        }
    }
    if( $i%7 &gt; 1 ) {
        for( $td=0; $td&lt;=7-($i%7); $td++) {
            $calendar .= '&lt;td&gt;&amp;nbsp;&lt;/td&gt;'.&quot;\n&quot;;
        }
    }
    $calendar .= '&lt;/tr&gt;'.&quot;\n&quot;;
    /* calendar body end   */
    $calendar .= '&lt;/table&gt;'.&quot;\n&quot;;
    $calendar .= '&lt;p class=&quot;summary&quot;&gt;◯…予約可能　△…やや空きあり　▼…残りわずか　-,×…予約不可&lt;/p&gt;&lt;/div&gt;'.&quot;\n&quot;;
    return $calendar;
}
// カレンダー全月分をショートコードに
function displayCalender() {
    // 現在の日付を設定
    $year    = date('Y');
    $month   = date('n');
    $day     = date('j');
    $date = mktime(0,0,0,$month,$day,$year);
    $today = $date;

    return '&lt;div id=&quot;reserveCalender&quot; class=&quot;main_calender&quot;&gt;'.output_single_calendar($year,$month).output_single_calendar($year,$month+1).output_single_calendar($year,$month+2).output_single_calendar($year,$month+3).output_single_calendar($year,$month+4).'&lt;/div&gt;';
}
add_shortcode('reservationCalender', 'displayCalender');
/*【ここまで】カスタム投稿とカスタムフィールドを使って予約状況を反映するカレンダーを作成*/
</code></pre>

<h3 id="enqueue-scriptへの追記内容">enqueue_scriptへの追記内容</h3>

<pre><code class="language-php">//wp_enqueue_script/styleを使ったファイル読み込み
if (!is_admin()) {
    function deregister_script(){  //　登録解除の項目
        wp_deregister_script('jquery');
    }
    function register_files(){  //　登録の項目
        wp_register_script( 'slick', get_theme_file_uri() .'/lib/js/slick.min.js', array( 'jquery' ), '', true);
        wp_register_style( 'slick', get_theme_file_uri() .'/lib/css/slick.css', array(), '', false);
        wp_register_style( 'slick-theme', get_theme_file_uri() .'/lib/css/slick-theme.css', array(), '', false);
        wp_register_style( 'calender', get_theme_file_uri() .'/lib/css/calender.css', array(), '', false);
    }
    function add_files() {  // 装備の項目
        wp_enqueue_script('slick');
        wp_enqueue_style('slick');
        wp_enqueue_style('slick-theme');
        wp_enqueue_style('calender');
    }
    add_action('wp_enqueue_scripts', 'add_files');
}
</code></pre>

<h3 id="独自css">独自CSS</h3>

<pre><code class="language-css">/*--------------------------------------------------
  予約状況
--------------------------------------------------*/
.post-type-archive-reservation  #main,
.single-reservation #main { width: auto; float: none; }
 
/* 個別ページ */
.main_calender .profile { overflow: hidden; }
.main_calender .profile img { float: left; margin: 0 20px 10px 0; }
.main_calender .profile .name small { font-size: 60%; color: #999; font-weight: normal; }
.main_calender .profile .course { font-size: 85.7%; margin-bottom: 10px; }
.main_calender .profile .introduction { margin: 0 0 30px 220px; }
 
.main_calender table { width: 100%; }
.main_calender table caption { font-size: 150%; font-weight: bold; color: #999; padding: 5px 0; }
.main_calender table tr th { border: solid 1px #ccc; padding: 3px; background: #666; color: #fff; text-align: center; }
.main_calender table tr th.sun { background: #e66; }
.main_calender table tr td { border: solid 1px #ccc; padding: .125rem .125rem .5rem .125rem ; text-align: center; line-height: 1.2; width: 14%; }
.main_calender table tr td.sun { background: #fee; }
.main_calender table tr td.holiday { background: #fee; }
.main_calender table tr td.today { background: #ffe; }
.main_calender table tr td span.day { display: block; text-align: left; color: #999; }
.main_calender table tr td span.off { font-size: 85.7%; color: #999; }
.main_calender table tr td span.undecided { font-size: 85.7%; color: #999; }
.main_calender td .tzone{padding:2.5% 0;margin: 0 10%;}
.main_calender td .tzone:nth-of-type(1){border-bottom: 1px solid #999;}
.main_calender .summary { margin: 3px 0 20px; text-align: right; }
 
.reservation-single .backToList { text-align: center; margin-bottom: 20px; }
.reservation-single .backToList a { display: inline-block; background: #999; color: #fff; padding: 0 10px; 
	font-size: 85.7%; line-height: 30px; font-weight: normal; 
	-webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px; 
}

.main_calender {
  margin: 0 auto;
  padding: 0 1.5rem;
  width: calc(100% - 2rem);
  color: #333;
  background-color: #f7f7f7;
}
.calender_content {
  text-align: center;
}
.slick-dots{
	left: 0;
}
.slick-prev,.slick-next{
	width: 2rem;
	height: 2rem;
}
.slick-prev{
	left: 0;
}
.slick-next{
	right: 0;
}
.slick-prev:before, .slick-next:before{
	content: &quot;&quot;;
	display: block;
	width: 100%;
	height: 100%;
	border: 1px solid #231f20;
	border-top-color:transparent; 
	border-right-color:transparent;
	transition: .3s;
}
.slick-prev:before{
	transform: rotateZ(45deg);
}
.slick-next:before{
	transform: rotateZ(-135deg);
}
</code></pre>

<h2 id="カスタムフィールド">カスタムフィールド</h2>

<pre><code class="language-php">//固定ページにカスタムフィールド追加
$custom_fields = array(
    'ttl'=&gt;array(
        'id'=&gt;'item_title',
        'info'=&gt;'タイトルを入力してください',
        'func'=&gt;'createItem'
    ),
    'txt'=&gt;array(
        'id'=&gt;'item_text',
        'info'=&gt;'概要を入力してください',
        'func'=&gt;'createMedia'
    ),
);
add_action( 'admin_menu', 'add_custom_field' );
function add_custom_field() {
    global $custom_fields;
    foreach($custom_fields as $key =&gt; $member) {
        //add_meta_box(フィールドのID , フィールドのタイトル, 管理画面に出力する関数, 表示するページ, 管理画面に表示する場所, 管理画面に表示する優先順位, 謎（初期値null）);
        add_meta_box($key , $member['info'], $member['func'],'page', 'normal','high',$member['id']);
    }
}

// カスタムフィールドのinputタイプHTMLを追加
function createItem($output, $key){
    $keyname = $key[&quot;args&quot;];
    global $post;
    // 保存されているカスタムフィールドの値を取得
    $get_value = get_post_meta( $post-&gt;ID, $keyname, true );

    // nonceの追加
    wp_nonce_field( 'action-' . $keyname, 'nonce-' . $keyname );

    // HTMLの出力
    echo '&lt;input name=&quot;' . $keyname . '&quot; value=&quot;' . $get_value . '&quot; style=&quot;width:100%;&quot;&gt;';
}
// カスタムフィールドのwpエディタタイプHTMLを追加
function createMedia($output, $key) {
    $keyname = $key[&quot;args&quot;];
    global $post;
    // 保存されているカスタムフィールドの値を取得
    $get_value = get_post_meta( $post-&gt;ID, $keyname, true );

    // nonceの追加
    wp_nonce_field( 'action-' . $keyname, 'nonce-' . $keyname );

    // HTMLの出力
    wp_editor( $get_value, $keyname . '-box', ['textarea_name' =&gt; $keyname] );
}
// カスタムフィールドの保存
function save_custom_field( $post_id ) {
    global $custom_fields;

    foreach( $custom_fields as $key =&gt; $member ) {
        if ( isset( $_POST['nonce-' . $member['id']] ) &amp;&amp; $_POST['nonce-' . $member['id']] ) {
            if( check_admin_referer( 'action-' . $member['id'], 'nonce-' . $member['id'] ) ) {

                if( isset( $_POST[$member['id']] ) &amp;&amp; $_POST[$member['id']] ) {
                    update_post_meta( $post_id, $member['id'], $_POST[$member['id']] );
                } else {
                    delete_post_meta( $post_id, $member['id'], get_post_meta( $post_id, $member['id'], true ) );
                }
            }
        }
        
    }
}
add_action( 'save_post', 'save_custom_field' );
     

//カスタムフィールドwpエディタ表示用タグ許可
function excerpt_display($string){
    $allowed_html = array(
        'span'  =&gt; array(
            'class' =&gt; array()
        ),
    );
    return wp_kses( $string , $allowed_html);
}
</code></pre>

<h2 id="カスタム投稿タイプ">カスタム投稿タイプ</h2>

<pre><code class="language-php">// カスタム投稿タイプの追加
function create_post_type() {
    $Supports = array(  // supports のパラメータを設定する配列（初期値だと title と editor のみ投稿画面で使える）
        'title',  // 記事タイトル
        'editor',  // 記事本文
        'excerpt',//抜粋
        'revisions',  // リビジョン
        'thumbnail',  //サムネイル
        'custom-fields'
    );
    register_post_type(
    'member', // 投稿タイプ名の定義
    array(
        'labels' =&gt; array(
                    'name' =&gt; __( '加盟団体' ), // 表示する投稿タイプ名
                    'singular_name' =&gt; __( '加盟団体' )
                    ),
        'public' =&gt; true,// 投稿タイプをパブリックにするか否か
        'exclude_from_search' =&gt; false,//サイト内検索結果に含まない
        'has_archive' =&gt; true,//アーカイブを作成
        'menu_position' =&gt;5,// 管理画面上でどこに配置するか今回の場合は「投稿」の下に配置
        'supports' =&gt; $Supports // 投稿画面でどのmoduleを使うか的な設定
        )
    );

    register_taxonomy(
      'member_taxonomy',  // 追加するタクソノミー名（英小文字とアンダースコアのみ）
      'member',  // どのカスタム投稿タイプに追加するか
      array(
        'label' =&gt; '団体区分',  // 管理画面上に表示される名前（投稿で言うカテゴリー）
        'labels' =&gt; array(
          'all_items' =&gt; '団体区分一覧',  // 投稿画面の右カラムに表示されるテキスト（投稿で言うカテゴリー一覧）
          'add_new_item' =&gt; '新規団体区分を追加',  // 投稿画面の右カラムに表示されるカテゴリ追加リンク
          'show_ui' =&gt; true
        ),
        'hierarchical' =&gt; true,
      )
    );

    register_taxonomy(
      'pref_taxonomy',  // 追加するタクソノミー名（英小文字とアンダースコアのみ）
      'member',  // どのカスタム投稿タイプに追加するか
      array(
        'label' =&gt; '都道府県',  // 管理画面上に表示される名前（投稿で言うカテゴリー）
        'labels' =&gt; array(
          'all_items' =&gt; '都道府県一覧',  // 投稿画面の右カラムに表示されるテキスト（投稿で言うカテゴリー一覧）
          'add_new_item' =&gt; '新規都道府県を追加',  // 投稿画面の右カラムに表示されるカテゴリ追加リンク
          'show_ui' =&gt; true
        ),
        'hierarchical' =&gt; true,
      )
    );
}
add_action( 'init', 'create_post_type' );
</code></pre>

</main>
<footer role="contentinfo" class="inline-center footer_wrapper">@2019~ haruki kawashita</footer>
</div>
<script type='text/javascript' src='https://haruharuharukichi.github.io/so-thin/js/toc.min.js'></script>
<script type='text/javascript' src='https://haruharuharukichi.github.io/so-thin/js/main.js'></script>
</body>

</html>